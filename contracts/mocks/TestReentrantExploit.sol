//SPDX-License-Identifier: MIT
pragma solidity ^0.8.22;

import "../nft/erc721m/ERC721M.sol";
import {ERC721A__IERC721Receiver} from "erc721a/contracts/extensions/ERC721AQueryable.sol";

contract TestReentrantExploit {
    address private _targetContract;

    constructor(address target) {
        _targetContract = target;
    }

    function exploit(uint32 qty, bytes32[] calldata proof, uint256 timestamp, bytes calldata signature)
        public
        payable
    {
        ERC721M(_targetContract).mint{value: msg.value}(qty, 0, proof, timestamp, signature);
    }

    function onERC721Received(
        address operator,
        address, // unused param: from
        uint256, // unused param: tokenId
        bytes calldata // unused param: data
    ) public payable returns (bytes4) {
        bytes32[] memory proof;
        ERC721M(_targetContract).mint{value: msg.value}(1, 0, proof, 0, "");
        return ERC721A__IERC721Receiver(operator).onERC721Received.selector;
    }
}
